

<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Albert Gil Escura | Desarrollador de aplicaciones, a veces me da por escribir.</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Albert Gil Escura" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Desarrollador de aplicaciones, a veces me da por escribir." />
<meta property="og:description" content="Desarrollador de aplicaciones, a veces me da por escribir." />
<link rel="canonical" href="/composable-architecture-alerts.html" />
<meta property="og:url" content="/composable-architecture-alerts.html" />
<meta property="og:site_name" content="Albert Gil Escura" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Albert Gil Escura" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Desarrollador de aplicaciones, a veces me da por escribir.","headline":"Albert Gil Escura","url":"/composable-architecture-alerts.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/colors-auto.css?v=">
    <link rel="stylesheet" href="/assets/css/style.css?v=">

    <link rel="preload" href="" as="image">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">

<!-- Setup Google Analytics -->


<!-- You can set your favicon here -->


<!-- end custom head snippets -->

  </head>
  <body>
    <div class="wrapper">
      <div class="sidebar">
        <header>
          

          
            <h1><a href="/">Albert Gil Escura</a></h1>
          

          
            <p class="addr"><i class="fa-regular fa-envelope"></i>&nbsp;agilescura@gmail.com</p>
          

          <p>Desarrollador de aplicaciones, a veces me da por escribir.</p>

          <div class="link-wrapper">
    <style scoped>
      ul.link a {
        color:var(--clr-h1-and-bold);
        text-decoration:none;
      }

      ul.link a:hover, a:focus {
        color: var(--clr-a-text-hvr);
      }
    </style>
    <ul class="link">
    </ul>
  </div>


        </header>

        <div class="link-wrapper-mobile" id="link-wrapper-mobile">
    <style scoped>
        #link-wrapper-mobile a {
        color:var(--clr-h1-and-bold);
        text-decoration:none;
        }

        #link-wrapper-mobile a:hover, a:focus {
        color: var(--clr-a-text-hvr);
        }
    </style>
</div>


        <div class="sidebar-footer"><p><small>Powered by <a href="https://jekyllrb.com/">Jekyll</a> &mdash; Theme by <a href="https://www.bodunhu.com/">BDHU</a></small></p></div>
      </div>
      <section>

      <h1 id="swiftui-navegación-y-the-composable-architecture-primera-parte-alertas">SwiftUI, Navegación y The Composable Architecture. Primera parte, alertas.</h1>

<p>Antes de empezar a leer este artículo, recomiendo ver <a href="https://www.pointfree.co/collections/swiftui/navigation">la serie de navegación de SwiftUI</a>. Además, si no estás familiarizado con The Composable Architecture, mejor accede al <a href="https://github.com/pointfreeco/swift-composable-architecture">repositorio</a> y mira los Case Studies que hay; son muy buenos!</p>

<p>Por resumir un poco, la solución que ofrece Apple para la navegación en SwiftUI ofrece muchas lagunas. ¿Qué ocurre cuando en una pantalla hay muchas opciones para navegar? Imaginemos que tenemos una pantalla con una alerta para cuando no tenemos conexión de internet, otra alerta para realizar una acción de peligro, un sheet para cuando hay un error en la llamada de internet, una navegación hacia un detalle, etc, etc.</p>

<p>La representación de estos estados en SwiftUI, se haría de una forma similar a esta.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@Published</span> <span class="k">var</span> <span class="nv">alertNoInternet</span> <span class="o">=</span> <span class="kc">false</span>
<span class="kd">@Published</span> <span class="k">var</span> <span class="nv">alertRemoveItem</span> <span class="o">=</span> <span class="kc">false</span>
<span class="kd">@Published</span> <span class="k">var</span> <span class="nv">sheetRequestError</span> <span class="o">=</span> <span class="kc">false</span>
<span class="kd">@Published</span> <span class="k">var</span> <span class="nv">navigateToDetail</span> <span class="o">=</span> <span class="kc">false</span>
</code></pre></div></div>

<p>Pero, haciendo un mapeado de este estilo, estamos incrementando la complejidad accidental de nuestro proyecto añadiendo estados imposibles. ¿Qué ocurriría si tuvieramos un estado así? Sería un estado imposible que genera un comportamiento erróneo.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@Published</span> <span class="k">var</span> <span class="nv">alertNoInternet</span> <span class="o">=</span> <span class="kc">true</span>
<span class="kd">@Published</span> <span class="k">var</span> <span class="nv">alertRemoveItem</span> <span class="o">=</span> <span class="kc">true</span>
<span class="kd">@Published</span> <span class="k">var</span> <span class="nv">sheetRequestError</span> <span class="o">=</span> <span class="kc">true</span>
<span class="kd">@Published</span> <span class="k">var</span> <span class="nv">navigateToDetail</span> <span class="o">=</span> <span class="kc">true</span>
</code></pre></div></div>

<blockquote>
  <p><strong><em>NOTA</em></strong> En nuevas versiones en SwiftUI, se prefiere utilizar un Binding de un objeto, en vez de un boleano, de forma que si el objeto existe, se lanza la navegación y en caso contrario, se dismisea la pantalla. Esta forma, aunque se simplifica un poco el código porque ya no hace falta controlar la navegación con dos variables, continua siendo engorrosa para el caso de que una pantalla tenga muchas posibilidades de navegación.</p>
</blockquote>

<p>Seguramente el comportamiento de la aplicación no sería el esperado. Pues bien, la solución que nos ofrece Pointfree en la serie de navegación con SwiftUI es mapear la pantalla justamente con los estados suficientes.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@Published</span> <span class="k">var</span> <span class="nv">route</span><span class="p">:</span> <span class="kt">Route</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>

<span class="kd">enum</span> <span class="kt">Route</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">alertNoInternet</span>
    <span class="k">case</span> <span class="n">alertRemoveItem</span>
    <span class="k">case</span> <span class="nf">sheetRequestError</span><span class="p">(</span><span class="kt">RequestErrorViewModel</span><span class="p">)</span>
    <span class="k">case</span> <span class="nf">navigateToDetail</span><span class="p">(</span><span class="kt">DetailViewModel</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Este planteamiento es sencillo y elegante. Además, permite la construcción de un sistema de deeplink de forma sencilla y, más importante aún, modularizable.</p>

<p>Sin embargo, no existe, aún, una solución similar en The Composable Architecture. Pero, mientras estamos esperando, con muchas ganas eso sí, que aparezca ya la integración de la navegación con el TCA, escribo este artículo ofreciendo una solución a este problema. A modo de experimento y diversión.</p>

<h2 id="todo-empieza-con-un-proyecto-de-ejemplo">Todo empieza con un proyecto de ejemplo.</h2>

<p>Vamos a empezar a diseñar un proyecto sencillo.</p>

<ul>
  <li>Tendremos un listado de números que inicialmente estará vacío.</li>
  <li>Tendremos la posibilidad de añadir un número dándole al botón + de la esquina superior derecha.</li>
  <li>Podemos hacer swipe derecha para eliminar un elemento del listado. Se mostrará una alerta avisando de que estamos a punto de eliminar el elemento.</li>
  <li>Podemos hacer swipe izquiera para poder cambiar el background a uno de los colores disponibles. Se mostrará un action sheet o confirmation dialog (como se llama en SwiftUI).</li>
</ul>

<h2 id="the-composable-architecture-basics">The Composable Architecture: Basics</h2>

<p>Empezaremos creando un proyecto, yo lo he llamado TCAlertsInvestigation y le añadiremos The Composable Architecture como dependencia.</p>

<p>Como es un primer proyecto de investigación, no voy a modularizar nada, ni a crear ninguna librería. Es una prueba nada más.</p>

<p>Empezaremos por construir el listado de items. En TCA, empezamos por el estado de la aplicación.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">AppState</span><span class="p">:</span> <span class="kt">Equatable</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">items</span><span class="p">:</span> <span class="kt">IdentifiedArrayOf</span><span class="o">&lt;</span><span class="kt">Item</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="kd">struct</span> <span class="kt">Item</span><span class="p">:</span> <span class="kt">Identifiable</span><span class="p">,</span> <span class="kt">Equatable</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">Int</span>
    
        <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">value</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p><strong><em>Nota</em></strong> IdentifiedArrayOf es un array con un identificar UUID, que nos permite realizar búsquedas más eficientemente que con Array.</p>
</blockquote>

<p>El siguiente objeto son las acciones que tendrá nuestra aplicación. De momento, solo queremos añadir un número al listado.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="kt">AppAction</span><span class="p">:</span> <span class="kt">Equatable</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">addItemButtonTapped</span>
<span class="p">}</span>
</code></pre></div></div>

<p>El tercer objeto es el Environment. En este proyecto, de momento, no tenemos necesidad de hacer uso de el.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">AppEnvironment</span> <span class="p">{}</span>
</code></pre></div></div>

<p>El cuarto objeto es el Reducer. Es el encargado de ejecutar las acciones.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">appReducer</span> <span class="o">=</span> <span class="kt">Reducer</span><span class="o">&lt;</span>
<span class="kt">AppState</span><span class="p">,</span>
<span class="kt">AppAction</span><span class="p">,</span>
<span class="kt">AppEnvironment</span>
<span class="o">&gt;</span> <span class="p">{</span> <span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">_</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">action</span> <span class="p">{</span>
        
    <span class="k">case</span> <span class="o">.</span><span class="nv">addItemButtonTapped</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">random</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="mi">0</span><span class="o">...</span><span class="mi">100</span><span class="p">)))</span>
        <span class="k">return</span> <span class="o">.</span><span class="k">none</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Finalmente, crearemos el Store y la vista AppView.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">AppView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">store</span><span class="p">:</span> <span class="kt">Store</span><span class="o">&lt;</span><span class="kt">AppState</span><span class="p">,</span> <span class="kt">AppAction</span><span class="o">&gt;</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">WithViewStore</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">store</span><span class="p">)</span> <span class="p">{</span> <span class="n">viewStore</span> <span class="k">in</span>
            <span class="kt">NavigationView</span> <span class="p">{</span>
                <span class="kt">List</span> <span class="p">{</span>
                    <span class="kt">ForEach</span><span class="p">(</span><span class="n">viewStore</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="p">{</span> <span class="n">item</span> <span class="k">in</span>
                        <span class="kt">Text</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="o">.</span><span class="nf">navigationTitle</span><span class="p">(</span><span class="s">"Items"</span><span class="p">)</span>
                <span class="o">.</span><span class="n">toolbar</span> <span class="p">{</span>
                    <span class="kt">ToolbarItem</span><span class="p">(</span><span class="nv">placement</span><span class="p">:</span> <span class="o">.</span><span class="n">navigationBarTrailing</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kt">Button</span><span class="p">(</span>
                            <span class="nv">action</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">addItemButtonTapped</span><span class="p">)</span> <span class="p">},</span>
                            <span class="nv">label</span><span class="p">:</span> <span class="p">{</span> <span class="kt">Image</span><span class="p">(</span><span class="nv">systemName</span><span class="p">:</span> <span class="s">"plus"</span><span class="p">)</span> <span class="p">}</span>
                        <span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Ahora, actualizamos tanto el preview como el programa principal.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">AppView</span><span class="p">(</span>
    <span class="nv">store</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span>
        <span class="nv">initialState</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">(),</span>
        <span class="nv">reducer</span><span class="p">:</span> <span class="n">appReducer</span><span class="p">,</span>
        <span class="nv">environment</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">()</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Ahora tenemos una app funcional que va añadiendo números aleatorios a un listado.</p>

<h2 id="route">Route</h2>

<p>Para añadir una alerta, primero tenemos que crear un Route en el AppState.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="nv">route</span><span class="p">:</span> <span class="kt">Route</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>

<span class="kd">enum</span> <span class="kt">Route</span><span class="p">:</span> <span class="kt">Equatable</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">removeItemAlert</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Lo que nos gustaría es poder instanciar cualquier alerta desde un Reducer, con lo cual con un case sin pattern matching no sería suficiente. Necesitamos un objeto asociado al case de la alerta. Vamos a construirlo.</p>

<p>Una alerta tiene un titulo y un mensaje. El título es obligado pero el mensaje es opcional.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ActionViewModel</span><span class="p">:</span> <span class="kt">Equatable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
<span class="p">}</span>
</code></pre></div></div>

<p>De momento, nos quedamos con estos objetos. Más adelante, podremos generalizar el ActionViewModel con más información. Podemos actualizar el route.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="nf">removeItemAlert</span><span class="p">(</span><span class="kt">ActionViewModel</span><span class="p">)</span>
</code></pre></div></div>

<p>Tenemos que añadir más acciones y actualizar el reducer.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="nf">removeAlertButtonTapped</span><span class="p">(</span><span class="kt">AppState</span><span class="o">.</span><span class="kt">Item</span><span class="p">)</span>
<span class="k">case</span> <span class="nf">removeButtonTapped</span><span class="p">(</span><span class="kt">AppState</span><span class="o">.</span><span class="kt">Item</span><span class="p">)</span>
<span class="k">case</span> <span class="n">dismissButtonTapped</span>
</code></pre></div></div>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">removeAlertButtonTapped</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">item</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="nv">id</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="o">.</span><span class="k">none</span> <span class="p">}</span>
        
    <span class="n">state</span><span class="o">.</span><span class="n">route</span> <span class="o">=</span> <span class="o">.</span><span class="nf">removeItemAlert</span><span class="p">(</span>
        <span class="o">.</span><span class="nf">init</span><span class="p">(</span>
            <span class="nv">title</span><span class="p">:</span> <span class="s">"Cambiar estilo"</span><span class="p">,</span>
            <span class="nv">message</span><span class="p">:</span> <span class="s">"¿Estás a punto de cambiar el estilo </span><span class="se">\(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="se">)</span><span class="s">?"</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="o">.</span><span class="k">none</span>
        
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">removeButtonTapped</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">.</span><span class="k">none</span>
        
    <span class="k">case</span> <span class="o">.</span><span class="nv">dismissButtonTapped</span><span class="p">:</span>
    <span class="n">state</span><span class="o">.</span><span class="n">route</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="k">return</span> <span class="o">.</span><span class="k">none</span>
</code></pre></div></div>

<blockquote>
  <p><strong><em>Nota</em></strong> Este artículo se centra en la navegación pero, para hacer bien esta parte, quizás deberíamos derivar el listado y usar un ForEachStore, de esta forma, no habría necesidad de utilizar acciones que tengan como parámetro el elemento al que queremos borrar.</p>
</blockquote>

<h2 id="casepaths-bindings-and-alerts">CasePaths, Bindings and Alerts</h2>

<p>Ahora tenemos que recuperar los métodos de la serie de navigation. Necesitamos la función que une el binding del Route con su case para obtener el binding del pattern matching.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">Binding</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="p">`</span><span class="nv">case</span><span class="p">`</span><span class="o">&lt;</span><span class="kt">Enum</span><span class="p">,</span> <span class="kt">Case</span><span class="o">&gt;</span><span class="p">(</span>
        <span class="n">_</span> <span class="nv">casePath</span><span class="p">:</span> <span class="kt">CasePath</span><span class="o">&lt;</span><span class="kt">Enum</span><span class="p">,</span> <span class="kt">Case</span><span class="o">&gt;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Binding</span><span class="o">&lt;</span><span class="kt">Case</span><span class="p">?</span><span class="o">&gt;</span> <span class="k">where</span> <span class="kt">Value</span> <span class="o">==</span> <span class="kt">Enum</span><span class="p">?</span> <span class="p">{</span>
        <span class="kt">Binding</span><span class="o">&lt;</span><span class="kt">Case</span><span class="p">?</span><span class="o">&gt;</span><span class="p">(</span>
            <span class="nv">get</span><span class="p">:</span> <span class="p">{</span>
                <span class="k">guard</span>
                    <span class="k">let</span> <span class="nv">wrappedValue</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">wrappedValue</span><span class="p">,</span>
                    <span class="kd">let</span> <span class="p">`</span><span class="nv">case</span><span class="p">`</span> <span class="o">=</span> <span class="n">casePath</span><span class="o">.</span><span class="nf">extract</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">wrappedValue</span><span class="p">)</span>
                <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
                <span class="k">return</span> <span class="p">`</span><span class="nv">case</span><span class="p">`</span>
            <span class="p">},</span>
            <span class="nv">set</span><span class="p">:</span> <span class="p">{</span> <span class="p">`</span><span class="nv">case</span><span class="p">`</span> <span class="k">in</span>
                <span class="k">if</span> <span class="kd">let</span> <span class="p">`</span><span class="nv">case</span><span class="p">`</span> <span class="o">=</span> <span class="p">`</span><span class="nv">case</span><span class="p">`</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">wrappedValue</span> <span class="o">=</span> <span class="n">casePath</span><span class="o">.</span><span class="nf">embed</span><span class="p">(`</span><span class="nv">case</span><span class="p">`)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">wrappedValue</span> <span class="o">=</span> <span class="kc">nil</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Ahora tenemos que adaptar la versión de la alert para que sea compatible con el ActionViewModel que hemos creado antes.</p>

<ul>
  <li>El primer parámetro prefiero llamarlo route ya que hace referencia al route de la pantalla, en vez, de unwrap. Por otro lado, no es necesario usar un Binding, así que la entrada es un optional Enum.</li>
  <li>El case será el valor que tenemos del route para la alerta.</li>
  <li>Las acciones se quedan como estan pero devolverá un objeto de tipo ActionViewModel</li>
  <li>Por último, necesitamos en TCA devolver el onDismiss para que se ejecute la accion de dismisear en el reducer.</li>
</ul>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="n">alert</span><span class="o">&lt;</span><span class="kt">A</span><span class="p">:</span> <span class="kt">View</span><span class="p">,</span> <span class="kt">Enum</span><span class="p">,</span> <span class="kt">Case</span><span class="o">&gt;</span><span class="p">(</span>
        <span class="n">route</span> <span class="nv">optionalValue</span><span class="p">:</span> <span class="kt">Enum</span><span class="p">?,</span>
        <span class="k">case</span> <span class="nv">casePath</span><span class="p">:</span> <span class="kt">CasePath</span><span class="o">&lt;</span><span class="kt">Enum</span><span class="p">,</span> <span class="kt">Case</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="kd">@ViewBuilder</span> <span class="nv">actions</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">ActionViewModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">A</span><span class="p">,</span>
        <span class="nv">onDismiss</span><span class="p">:</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">pattern</span> <span class="o">=</span> <span class="kt">Binding</span><span class="o">.</span><span class="nf">constant</span><span class="p">(</span><span class="n">optionalValue</span><span class="p">)</span><span class="o">.</span><span class="k">case</span><span class="p">(</span><span class="n">casePath</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">presenting</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">wrappedValue</span> <span class="k">as?</span> <span class="kt">ActionViewModel</span>
        
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="nf">alert</span><span class="p">(</span>
            <span class="kt">Text</span><span class="p">(</span><span class="n">presenting</span><span class="p">?</span><span class="o">.</span><span class="n">title</span> <span class="p">??</span> <span class="s">""</span><span class="p">),</span>
            <span class="nv">isPresented</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span>
                <span class="nv">get</span><span class="p">:</span> <span class="p">{</span> <span class="n">pattern</span><span class="o">.</span><span class="n">wrappedValue</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">},</span>
                <span class="nv">set</span><span class="p">:</span> <span class="p">{</span> <span class="n">isPresented</span> <span class="k">in</span>
                    <span class="k">if</span> <span class="o">!</span><span class="n">isPresented</span> <span class="p">{</span>
                        <span class="nf">onDismiss</span><span class="p">?()</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">),</span>
            <span class="nv">presenting</span><span class="p">:</span> <span class="n">presenting</span><span class="p">,</span>
            <span class="nv">actions</span><span class="p">:</span> <span class="n">actions</span><span class="p">,</span>
            <span class="nv">message</span><span class="p">:</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">message</span> <span class="o">=</span> <span class="nv">$0</span><span class="o">.</span><span class="n">message</span> <span class="p">{</span>
                    <span class="kt">Text</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>En la vista ahora añadiremos un swipeAction.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">Text</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">swipeActions</span><span class="p">(</span>
        <span class="nv">edge</span><span class="p">:</span> <span class="o">.</span><span class="n">trailing</span><span class="p">,</span>
        <span class="nv">allowsFullSwipe</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="kt">Button</span><span class="p">(</span>
            <span class="nv">action</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="nf">removeAlertButtonTapped</span><span class="p">(</span><span class="n">item</span><span class="p">))</span> <span class="p">},</span>
            <span class="nv">label</span><span class="p">:</span> <span class="p">{</span> <span class="kt">Text</span><span class="p">(</span><span class="s">"Remove"</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="nf">tint</span><span class="p">(</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Pero tenemos ahora un problema. Necesitamos guardar el item, de forma temporal, para luego ejecutar la acción en la alerta. Actualizaremos el AppState.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">Item</span><span class="p">?</span>
</code></pre></div></div>

<p>Y ya, por último, agregaremos la alerta, debajo del toolbar.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="nf">alert</span><span class="p">(</span>
    <span class="nv">route</span><span class="p">:</span> <span class="n">viewStore</span><span class="o">.</span><span class="n">route</span><span class="p">,</span>
    <span class="nv">case</span><span class="p">:</span> <span class="o">/</span><span class="kt">AppState</span><span class="o">.</span><span class="kt">Route</span><span class="o">.</span><span class="n">removeItemAlert</span><span class="p">,</span>
    <span class="nv">actions</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
        <span class="kt">Button</span><span class="p">(</span>
            <span class="s">"Borrar"</span><span class="p">,</span>
            <span class="nv">role</span><span class="p">:</span> <span class="o">.</span><span class="n">destructive</span><span class="p">,</span>
            <span class="nv">action</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">removeButtonTapped</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">},</span>
    <span class="nv">onDismiss</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">dismissButtonTapped</span><span class="p">)</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Ya tenemos implementado el borrado de un elemento de una lista, usando una alerta con un enum Route dentro de TCA.</p>

<p>Principales problemas que tenemos ahora mismo.</p>

<ul>
  <li>En el AppState, tenemos una variable temporal que usamos para borrar un elemento.</li>
  <li>Si queremos usar varias alertas, en una misma pantalla, tendríamos que crear varios cases, tantos como tipos de alerta tengamos.</li>
</ul>

<p>En general, tenemos acoplado el alert a la vista. Siguiente paso, desacoplarlo, de forma que, desde el reducer podamos crear una alerta. Esto va a ser especialmente importante con el confirmationDialog, ya que este componente, si suele ser más dinámico.</p>

<h2 id="desacoplamiento-de-las-actions-en-el-actionviewmodel">Desacoplamiento de las actions en el ActionViewModel</h2>

<p>Queremos añadir los botones en el ActionViewModel para poder instanciar una alerta desde el reducer. En una primera iteración, añadiremos un array de botones con un título y un rol, y nos dejaremos la acción del botón para el final.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ActionViewModel</span><span class="p">:</span> <span class="kt">Equatable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">let</span> <span class="nv">buttons</span><span class="p">:</span> <span class="p">[</span><span class="kt">ActionViewModel</span><span class="o">.</span><span class="kt">Button</span><span class="p">]</span>
    
    <span class="kd">struct</span> <span class="kt">Button</span><span class="p">:</span> <span class="kt">Hashable</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span>
        <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">role</span><span class="p">:</span> <span class="kt">ButtonRole</span><span class="p">?</span>
        
        <span class="nf">init</span><span class="p">(</span>
            <span class="n">_</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span>
            <span class="nv">role</span><span class="p">:</span> <span class="kt">ButtonRole</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
        <span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
            <span class="k">self</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">role</span>
        <span class="p">}</span>
        
        <span class="kd">func</span> <span class="nf">hash</span><span class="p">(</span><span class="n">into</span> <span class="nv">hasher</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">Hasher</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">hasher</span><span class="o">.</span><span class="nf">combine</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="kd">static</span> <span class="kd">func</span> <span class="o">==</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="k">Self</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="k">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
            <span class="n">lhs</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">id</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Ahora actualizaremos la actualización del route dentro del reducer</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">state</span><span class="o">.</span><span class="n">route</span> <span class="o">=</span> <span class="o">.</span><span class="nf">removeItemAlert</span><span class="p">(</span>
    <span class="o">.</span><span class="nf">init</span><span class="p">(</span>
        <span class="nv">title</span><span class="p">:</span> <span class="s">"Cambiar estilo"</span><span class="p">,</span>
        <span class="nv">message</span><span class="p">:</span> <span class="s">"¿Estás a punto de cambiar el estilo </span><span class="se">\(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="se">)</span><span class="s">?"</span><span class="p">,</span>
        <span class="nv">buttons</span><span class="p">:</span> <span class="p">[</span>
            <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="s">"Delete"</span><span class="p">,</span> <span class="nv">role</span><span class="p">:</span> <span class="o">.</span><span class="n">destructive</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Y, por último, la alerta, para que lea el botón del route.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="nf">alert</span><span class="p">(</span>
    <span class="nv">route</span><span class="p">:</span> <span class="n">viewStore</span><span class="o">.</span><span class="n">route</span><span class="p">,</span>
    <span class="nv">case</span><span class="p">:</span> <span class="o">/</span><span class="kt">AppState</span><span class="o">.</span><span class="kt">Route</span><span class="o">.</span><span class="n">removeItemAlert</span><span class="p">,</span>
    <span class="nv">actions</span><span class="p">:</span> <span class="p">{</span> <span class="n">actionViewModel</span> <span class="k">in</span>
        <span class="kt">Button</span><span class="p">(</span>
            <span class="n">actionViewModel</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
            <span class="nv">role</span><span class="p">:</span> <span class="n">actionViewModel</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">role</span><span class="p">,</span>
            <span class="nv">action</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">removeButtonTapped</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">},</span>
    <span class="nv">onDismiss</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">dismissButtonTapped</span><span class="p">)</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Sin embargo, buttons es un array, así que bien podríamos poner ahí un ForEach. Algo así,</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">ForEach</span><span class="p">(</span><span class="n">actionViewModel</span><span class="o">.</span><span class="n">buttons</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">button</span> <span class="k">in</span>
    <span class="kt">Button</span><span class="p">(</span>
        <span class="n">button</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
        <span class="nv">role</span><span class="p">:</span> <span class="n">button</span><span class="o">.</span><span class="n">role</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">removeButtonTapped</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Pero seguimos teniendo, la acción hardcodeada en la vista.</p>

<h2 id="generalizar-las-acciones-en-la-vista">Generalizar las acciones en la vista</h2>

<p>Las acciones del ActionViewModel van a ser las acciones del TCA, por lo tanto, vamos a necesitar un genérico. Una posible solución es esta.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ActionViewModel</span><span class="o">&lt;</span><span class="kt">Action</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">Equatable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">let</span> <span class="nv">buttons</span><span class="p">:</span> <span class="p">[</span><span class="kt">ActionViewModel</span><span class="o">.</span><span class="kt">Button</span><span class="o">&lt;</span><span class="kt">Action</span><span class="o">&gt;</span><span class="p">]</span>
    
    <span class="nf">init</span><span class="p">(</span>
        <span class="n">_</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span>
        <span class="nv">message</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">,</span>
        <span class="nv">buttons</span><span class="p">:</span> <span class="p">[</span><span class="kt">ActionViewModel</span><span class="o">.</span><span class="kt">Button</span><span class="o">&lt;</span><span class="kt">Action</span><span class="o">&gt;</span><span class="p">]</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="k">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="k">self</span><span class="o">.</span><span class="n">buttons</span> <span class="o">=</span> <span class="n">buttons</span>
    <span class="p">}</span>
    
    <span class="kd">struct</span> <span class="kt">Button</span><span class="o">&lt;</span><span class="kt">Action</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">Hashable</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span>
        <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">role</span><span class="p">:</span> <span class="kt">ButtonRole</span><span class="p">?</span>
        <span class="k">let</span> <span class="nv">action</span><span class="p">:</span> <span class="kt">Action</span>
        
        <span class="nf">init</span><span class="p">(</span>
            <span class="n">_</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span>
            <span class="nv">role</span><span class="p">:</span> <span class="kt">ButtonRole</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">,</span>
            <span class="nv">action</span><span class="p">:</span> <span class="kt">Action</span>
        <span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
            <span class="k">self</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">role</span>
            <span class="k">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
        <span class="p">}</span>
        
        <span class="kd">func</span> <span class="nf">hash</span><span class="p">(</span><span class="n">into</span> <span class="nv">hasher</span><span class="p">:</span> <span class="k">inout</span> <span class="kt">Hasher</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">hasher</span><span class="o">.</span><span class="nf">combine</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="kd">static</span> <span class="kd">func</span> <span class="o">==</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="k">Self</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="k">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
            <span class="n">lhs</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">id</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Ahora, tenemos que adaptar el código a este nuevo tipo. Lo primero será actualizar el tipo ActionViewModel a ActionViewModel<Value>.
Después, como estamos usando un genérico, tenemos que usar su tipo y pasarselo como parámetro.</Value></p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="n">alert</span><span class="o">&lt;</span><span class="kt">A</span><span class="p">:</span> <span class="kt">View</span><span class="p">,</span> <span class="kt">Enum</span><span class="p">,</span> <span class="kt">Case</span><span class="p">,</span> <span class="kt">Action</span><span class="o">&gt;</span><span class="p">(</span>
        <span class="n">route</span> <span class="nv">optionalValue</span><span class="p">:</span> <span class="kt">Enum</span><span class="p">?,</span>
        <span class="k">case</span> <span class="nv">casePath</span><span class="p">:</span> <span class="kt">CasePath</span><span class="o">&lt;</span><span class="kt">Enum</span><span class="p">,</span> <span class="kt">Case</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="nv">action</span><span class="p">:</span> <span class="kt">Action</span><span class="o">.</span><span class="k">Type</span><span class="p">,</span>
        <span class="kd">@ViewBuilder</span> <span class="nv">actions</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">ActionViewModel</span><span class="o">&lt;</span><span class="kt">Action</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">A</span><span class="p">,</span>
        <span class="nv">onDismiss</span><span class="p">:</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">pattern</span> <span class="o">=</span> <span class="kt">Binding</span><span class="o">.</span><span class="nf">constant</span><span class="p">(</span><span class="n">optionalValue</span><span class="p">)</span><span class="o">.</span><span class="k">case</span><span class="p">(</span><span class="n">casePath</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">presenting</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">wrappedValue</span> <span class="k">as?</span> <span class="kt">ActionViewModel</span><span class="o">&lt;</span><span class="kt">Action</span><span class="o">&gt;</span>
        
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="nf">alert</span><span class="p">(</span>
            <span class="kt">Text</span><span class="p">(</span><span class="n">presenting</span><span class="p">?</span><span class="o">.</span><span class="n">title</span> <span class="p">??</span> <span class="s">""</span><span class="p">),</span>
            <span class="nv">isPresented</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span>
                <span class="nv">get</span><span class="p">:</span> <span class="p">{</span> <span class="n">pattern</span><span class="o">.</span><span class="n">wrappedValue</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">},</span>
                <span class="nv">set</span><span class="p">:</span> <span class="p">{</span> <span class="n">isPresented</span> <span class="k">in</span>
                    <span class="k">if</span> <span class="o">!</span><span class="n">isPresented</span> <span class="p">{</span>
                        <span class="nf">onDismiss</span><span class="p">?()</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">),</span>
            <span class="nv">presenting</span><span class="p">:</span> <span class="n">presenting</span><span class="p">,</span>
            <span class="nv">actions</span><span class="p">:</span> <span class="n">actions</span><span class="p">,</span>
            <span class="nv">message</span><span class="p">:</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">message</span> <span class="o">=</span> <span class="nv">$0</span><span class="o">.</span><span class="n">message</span> <span class="p">{</span>
                    <span class="kt">Text</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Resolvemos errores.</p>

<ul>
  <li>En la definición del route.</li>
</ul>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="nf">removeItemAlert</span><span class="p">(</span><span class="kt">ActionViewModel</span><span class="o">&lt;</span><span class="kt">AppAction</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Cuando usamos el route para asignar la alerta.</li>
</ul>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">state</span><span class="o">.</span><span class="n">route</span> <span class="o">=</span> <span class="o">.</span><span class="nf">removeItemAlert</span><span class="p">(</span>
    <span class="o">.</span><span class="nf">init</span><span class="p">(</span>
        <span class="s">"Cambiar estilo"</span><span class="p">,</span>
        <span class="nv">message</span><span class="p">:</span> <span class="s">"¿Estás a punto de cambiar el estilo </span><span class="se">\(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="se">)</span><span class="s">?"</span><span class="p">,</span>
        <span class="nv">buttons</span><span class="p">:</span> <span class="p">[</span>
            <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="s">"Delete"</span><span class="p">,</span> <span class="nv">role</span><span class="p">:</span> <span class="o">.</span><span class="n">destructive</span><span class="p">,</span> <span class="nv">action</span><span class="p">:</span> <span class="o">.</span><span class="n">removeButtonTapped</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>Por último, en la alerta.</li>
</ul>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="nf">alert</span><span class="p">(</span>
    <span class="nv">route</span><span class="p">:</span> <span class="n">viewStore</span><span class="o">.</span><span class="n">route</span><span class="p">,</span>
    <span class="nv">case</span><span class="p">:</span> <span class="o">/</span><span class="kt">AppState</span><span class="o">.</span><span class="kt">Route</span><span class="o">.</span><span class="n">removeItemAlert</span><span class="p">,</span>
    <span class="nv">action</span><span class="p">:</span> <span class="kt">AppAction</span><span class="o">.</span><span class="k">self</span><span class="p">,</span>
    <span class="nv">actions</span><span class="p">:</span> <span class="p">{</span> <span class="n">actionViewModel</span> <span class="k">in</span>
        <span class="kt">ForEach</span><span class="p">(</span><span class="n">actionViewModel</span><span class="o">.</span><span class="n">buttons</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">button</span> <span class="k">in</span>
            <span class="kt">Button</span><span class="p">(</span>
                <span class="n">button</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                <span class="nv">role</span><span class="p">:</span> <span class="n">button</span><span class="o">.</span><span class="n">role</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="n">button</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nv">onDismiss</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">dismissButtonTapped</span><span class="p">)</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Podemos prescindir de pasar explicitamente la acción si en la clausura de las acciones hacemos explícito su tipo.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="nf">alert</span><span class="p">(</span>
    <span class="nv">route</span><span class="p">:</span> <span class="n">viewStore</span><span class="o">.</span><span class="n">route</span><span class="p">,</span>
    <span class="nv">case</span><span class="p">:</span> <span class="o">/</span><span class="kt">AppState</span><span class="o">.</span><span class="kt">Route</span><span class="o">.</span><span class="n">removeItemAlert</span><span class="p">,</span>
    <span class="nv">actions</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">actionViewModel</span><span class="p">:</span> <span class="kt">ActionViewModel</span><span class="o">&lt;</span><span class="kt">AppAction</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">in</span>
        <span class="kt">ForEach</span><span class="p">(</span><span class="n">actionViewModel</span><span class="o">.</span><span class="n">buttons</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">button</span> <span class="k">in</span>
            <span class="kt">Button</span><span class="p">(</span>
                <span class="n">button</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                <span class="nv">role</span><span class="p">:</span> <span class="n">button</span><span class="o">.</span><span class="n">role</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="n">button</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nv">onDismiss</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">dismissButtonTapped</span><span class="p">)</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Y eliminamos el parámetro action del alert.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">action</span><span class="p">:</span> <span class="kt">Action</span><span class="o">.</span><span class="k">Type</span><span class="p">,</span>
</code></pre></div></div>

<p>El código que tenemos en la vista, ya está desacoplado. Sin embargo, este codigo siempre será el mismo. Entonces, lo que vamos a hacer, será trasladar la clausura, a la implementación de la alerta.</p>

<p>Si copiamos la clausura de las actions a la alerta, nos estamos llevando la función send. Tendremos que añadir un parámetro de entrada send para enviar las acciones. Ya lo tendríamos.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="n">alert</span><span class="o">&lt;</span><span class="kt">Enum</span><span class="p">,</span> <span class="kt">Case</span><span class="p">,</span> <span class="kt">Action</span><span class="o">&gt;</span><span class="p">(</span>
        <span class="n">route</span> <span class="nv">optionalValue</span><span class="p">:</span> <span class="kt">Enum</span><span class="p">?,</span>
        <span class="k">case</span> <span class="nv">casePath</span><span class="p">:</span> <span class="kt">CasePath</span><span class="o">&lt;</span><span class="kt">Enum</span><span class="p">,</span> <span class="kt">Case</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="nv">send</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Action</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">,</span>
        <span class="nv">onDismiss</span><span class="p">:</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">pattern</span> <span class="o">=</span> <span class="kt">Binding</span><span class="o">.</span><span class="nf">constant</span><span class="p">(</span><span class="n">optionalValue</span><span class="p">)</span><span class="o">.</span><span class="k">case</span><span class="p">(</span><span class="n">casePath</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">presenting</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">wrappedValue</span> <span class="k">as?</span> <span class="kt">ActionViewModel</span><span class="o">&lt;</span><span class="kt">Action</span><span class="o">&gt;</span>
        
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="nf">alert</span><span class="p">(</span>
            <span class="kt">Text</span><span class="p">(</span><span class="n">presenting</span><span class="p">?</span><span class="o">.</span><span class="n">title</span> <span class="p">??</span> <span class="s">""</span><span class="p">),</span>
            <span class="nv">isPresented</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span>
                <span class="nv">get</span><span class="p">:</span> <span class="p">{</span> <span class="n">pattern</span><span class="o">.</span><span class="n">wrappedValue</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">},</span>
                <span class="nv">set</span><span class="p">:</span> <span class="p">{</span> <span class="n">isPresented</span> <span class="k">in</span>
                    <span class="k">if</span> <span class="o">!</span><span class="n">isPresented</span> <span class="p">{</span>
                        <span class="nf">onDismiss</span><span class="p">?()</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">),</span>
            <span class="nv">presenting</span><span class="p">:</span> <span class="n">presenting</span><span class="p">,</span>
            <span class="nv">actions</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">alertViewModel</span><span class="p">:</span> <span class="kt">ActionViewModel</span><span class="o">&lt;</span><span class="kt">Action</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">in</span>
                <span class="kt">ForEach</span><span class="p">(</span><span class="n">alertViewModel</span><span class="o">.</span><span class="n">buttons</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">button</span> <span class="k">in</span>
                    <span class="kt">Button</span><span class="p">(</span>
                        <span class="n">button</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                        <span class="nv">role</span><span class="p">:</span> <span class="n">button</span><span class="o">.</span><span class="n">role</span>
                    <span class="p">)</span> <span class="p">{</span>
                        <span class="nf">send</span><span class="p">(</span><span class="n">button</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nv">message</span><span class="p">:</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">message</span> <span class="o">=</span> <span class="nv">$0</span><span class="o">.</span><span class="n">message</span> <span class="p">{</span>
                    <span class="kt">Text</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Y su uso, en la vista, tendría esta forma.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="nf">alert</span><span class="p">(</span>
    <span class="nv">route</span><span class="p">:</span> <span class="n">viewStore</span><span class="o">.</span><span class="n">route</span><span class="p">,</span>
    <span class="nv">case</span><span class="p">:</span> <span class="o">/</span><span class="kt">AppState</span><span class="o">.</span><span class="kt">Route</span><span class="o">.</span><span class="n">removeItemAlert</span><span class="p">,</span>
    <span class="nv">send</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
    <span class="nv">onDismiss</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">dismissButtonTapped</span><span class="p">)</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<h2 id="confirmation-dialog">Confirmation Dialog</h2>

<p>El Confirmation Dialog es primo hermano del Alert. Así que iremos rápido.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="n">confirmationDialog</span><span class="o">&lt;</span><span class="kt">Enum</span><span class="p">,</span> <span class="kt">Case</span><span class="p">,</span> <span class="kt">Action</span><span class="o">&gt;</span><span class="p">(</span>
        <span class="n">route</span> <span class="nv">optionalValue</span><span class="p">:</span> <span class="kt">Enum</span><span class="p">?,</span>
        <span class="k">case</span> <span class="nv">casePath</span><span class="p">:</span> <span class="kt">CasePath</span><span class="o">&lt;</span><span class="kt">Enum</span><span class="p">,</span> <span class="kt">Case</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="nv">titleVisibility</span><span class="p">:</span> <span class="kt">Visibility</span> <span class="o">=</span> <span class="o">.</span><span class="n">automatic</span><span class="p">,</span>
        <span class="nv">send</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">(</span><span class="kt">Action</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">,</span>
        <span class="nv">onDismiss</span><span class="p">:</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">pattern</span> <span class="o">=</span> <span class="kt">Binding</span><span class="o">.</span><span class="nf">constant</span><span class="p">(</span><span class="n">optionalValue</span><span class="p">)</span><span class="o">.</span><span class="k">case</span><span class="p">(</span><span class="n">casePath</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">presenting</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">wrappedValue</span> <span class="k">as?</span> <span class="kt">ActionViewModel</span><span class="o">&lt;</span><span class="kt">Action</span><span class="o">&gt;</span>
        
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="nf">confirmationDialog</span><span class="p">(</span>
            <span class="kt">Text</span><span class="p">(</span><span class="n">presenting</span><span class="p">?</span><span class="o">.</span><span class="n">title</span> <span class="p">??</span> <span class="s">""</span><span class="p">),</span>
            <span class="nv">isPresented</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span>
                <span class="nv">get</span><span class="p">:</span> <span class="p">{</span> <span class="n">pattern</span><span class="o">.</span><span class="n">wrappedValue</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">},</span>
                <span class="nv">set</span><span class="p">:</span> <span class="p">{</span> <span class="n">isPresented</span> <span class="k">in</span>
                    <span class="k">if</span> <span class="o">!</span><span class="n">isPresented</span> <span class="p">{</span>
                        <span class="nf">onDismiss</span><span class="p">?()</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">),</span>
            <span class="nv">titleVisibility</span><span class="p">:</span> <span class="o">.</span><span class="n">visible</span><span class="p">,</span>
            <span class="nv">presenting</span><span class="p">:</span> <span class="n">presenting</span><span class="p">,</span>
            <span class="nv">actions</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="nv">alertViewModel</span><span class="p">:</span> <span class="kt">ActionViewModel</span><span class="o">&lt;</span><span class="kt">Action</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">in</span>
                <span class="kt">ForEach</span><span class="p">(</span><span class="n">alertViewModel</span><span class="o">.</span><span class="n">buttons</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">button</span> <span class="k">in</span>
                    <span class="kt">Button</span><span class="p">(</span>
                        <span class="n">button</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                        <span class="nv">role</span><span class="p">:</span> <span class="n">button</span><span class="o">.</span><span class="n">role</span>
                    <span class="p">)</span> <span class="p">{</span>
                        <span class="nf">send</span><span class="p">(</span><span class="n">button</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nv">message</span><span class="p">:</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">message</span> <span class="o">=</span> <span class="nv">$0</span><span class="o">.</span><span class="n">message</span> <span class="p">{</span>
                    <span class="kt">Text</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Y ahora, actualizaremos el proyecto para hacer un cambio en el listado.</p>

<p>Añade la definición de estilo siguiente:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="kt">Style</span><span class="p">:</span> <span class="kt">CaseIterable</span> <span class="p">{</span>
    <span class="k">case</span> <span class="k">none</span>
    <span class="k">case</span> <span class="n">yellow</span>
    <span class="k">case</span> <span class="n">blue</span>
    <span class="k">case</span> <span class="n">green</span>
    
    <span class="k">var</span> <span class="nv">color</span><span class="p">:</span> <span class="kt">Color</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="k">self</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">none</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">white</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">yellow</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">yellow</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">blue</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">blue</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">green</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">.</span><span class="n">green</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Actualiza el elemento Item:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">Item</span><span class="p">:</span> <span class="kt">Identifiable</span><span class="p">,</span> <span class="kt">Equatable</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">Int</span>
        <span class="k">var</span> <span class="nv">style</span><span class="p">:</span> <span class="kt">Style</span> <span class="o">=</span> <span class="o">.</span><span class="k">none</span>
        
        <span class="o">....</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Necesitamos un nuevo case en el Route para añadir el nuevo ConfirmationDialog.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="kt">Route</span><span class="p">:</span> <span class="kt">Equatable</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nf">removeItemAlert</span><span class="p">(</span><span class="kt">ActionViewModel</span><span class="o">&lt;</span><span class="kt">AppAction</span><span class="o">&gt;</span><span class="p">)</span>
        <span class="k">case</span> <span class="nf">changeStyleConfirmationDialog</span><span class="p">(</span><span class="kt">ActionViewModel</span><span class="o">&lt;</span><span class="kt">AppAction</span><span class="o">&gt;</span><span class="p">)</span>
        
        <span class="kd">static</span> <span class="kd">func</span> <span class="o">==</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="k">Self</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="k">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="k">let</span> <span class="p">(</span><span class="err">.</span><span class="nv">removeItemAlert</span><span class="p">(</span><span class="nv">lhsAlert</span><span class="p">),</span> <span class="err">.</span><span class="nv">removeItemAlert</span><span class="p">(</span><span class="nv">rhsAlert</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">lhsAlert</span> <span class="o">==</span> <span class="n">rhsAlert</span>
            <span class="k">case</span> <span class="k">let</span> <span class="p">(</span><span class="err">.</span><span class="nv">changeStyleConfirmationDialog</span><span class="p">(</span><span class="nv">lhsAlert</span><span class="p">),</span> <span class="err">.</span><span class="nv">changeStyleConfirmationDialog</span><span class="p">(</span><span class="nv">rhsAlert</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">lhsAlert</span> <span class="o">==</span> <span class="n">rhsAlert</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Añadiremos dos nuevas acciones al AppAction.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="nf">changeStyleConfirmationDialogButtonTapped</span><span class="p">(</span><span class="kt">AppState</span><span class="o">.</span><span class="kt">Item</span><span class="p">)</span>
<span class="k">case</span> <span class="nf">change</span><span class="p">(</span><span class="nv">style</span><span class="p">:</span> <span class="kt">AppState</span><span class="o">.</span><span class="kt">Item</span><span class="o">.</span><span class="kt">Style</span><span class="p">,</span> <span class="nv">item</span><span class="p">:</span> <span class="kt">AppState</span><span class="o">.</span><span class="kt">Item</span><span class="p">)</span>
</code></pre></div></div>

<p>Y, implementaremos su lógica dentro del Reducer:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">changeStyleConfirmationDialogButtonTapped</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="n">state</span><span class="o">.</span><span class="n">route</span> <span class="o">=</span> <span class="o">.</span><span class="nf">changeStyleConfirmationDialog</span><span class="p">(</span>
            <span class="o">.</span><span class="nf">init</span><span class="p">(</span>
                <span class="s">"Eliminar item"</span><span class="p">,</span>
                <span class="nv">message</span><span class="p">:</span> <span class="s">"¿Estás a punto de eliminar el item </span><span class="se">\(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="se">)</span><span class="s">?"</span><span class="p">,</span>
                <span class="nv">buttons</span><span class="p">:</span> <span class="kt">AppState</span><span class="o">.</span><span class="kt">Item</span><span class="o">.</span><span class="kt">Style</span><span class="o">.</span><span class="n">allCases</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">style</span> <span class="k">in</span>
                        <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">style</span><span class="se">)</span><span class="s">"</span><span class="p">,</span> <span class="nv">action</span><span class="p">:</span> <span class="o">.</span><span class="nf">change</span><span class="p">(</span><span class="nv">style</span><span class="p">:</span> <span class="n">style</span><span class="p">,</span> <span class="nv">item</span><span class="p">:</span> <span class="n">item</span><span class="p">))</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="o">.</span><span class="k">none</span>
            
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">change</span><span class="p">(</span><span class="nv">style</span><span class="p">:</span> <span class="n">style</span><span class="p">,</span> <span class="nv">item</span><span class="p">:</span> <span class="n">item</span><span class="p">):</span>
        <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="nv">id</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">id</span><span class="p">]?</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span>
        <span class="k">return</span> <span class="o">.</span><span class="k">none</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Ahora ya solo nos queda actualizar la vista.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">List</span> <span class="p">{</span>
    <span class="kt">ForEach</span><span class="p">(</span><span class="n">viewStore</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="p">{</span> <span class="n">item</span> <span class="k">in</span>
        <span class="kt">Text</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">listRowBackground</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">swipeActions</span><span class="p">(</span>
                <span class="nv">edge</span><span class="p">:</span> <span class="o">.</span><span class="n">trailing</span><span class="p">,</span>
                <span class="nv">allowsFullSwipe</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="kt">Button</span><span class="p">(</span>
                    <span class="nv">action</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="nf">removeAlertButtonTapped</span><span class="p">(</span><span class="n">item</span><span class="p">))</span> <span class="p">},</span>
                    <span class="nv">label</span><span class="p">:</span> <span class="p">{</span> <span class="kt">Text</span><span class="p">(</span><span class="s">"Remove"</span><span class="p">)</span> <span class="p">}</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="nf">tint</span><span class="p">(</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="nf">swipeActions</span><span class="p">(</span><span class="nv">edge</span><span class="p">:</span> <span class="o">.</span><span class="n">leading</span><span class="p">,</span> <span class="nv">allowsFullSwipe</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">Button</span><span class="p">(</span>
                    <span class="nv">action</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="nf">changeStyleConfirmationDialogButtonTapped</span><span class="p">(</span><span class="n">item</span><span class="p">))</span> <span class="p">},</span>
                    <span class="nv">label</span><span class="p">:</span> <span class="p">{</span> <span class="kt">Text</span><span class="p">(</span><span class="s">"Change color"</span><span class="p">)</span> <span class="p">}</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="nf">tint</span><span class="p">(</span><span class="o">.</span><span class="n">orange</span><span class="p">)</span>
            <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>y el uso del confirmation dialog es similar al de la alerta.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="nf">alert</span><span class="p">(</span>
    <span class="nv">route</span><span class="p">:</span> <span class="n">viewStore</span><span class="o">.</span><span class="n">route</span><span class="p">,</span>
    <span class="nv">case</span><span class="p">:</span> <span class="o">/</span><span class="kt">AppState</span><span class="o">.</span><span class="kt">Route</span><span class="o">.</span><span class="n">removeItemAlert</span><span class="p">,</span>
    <span class="nv">send</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
    <span class="nv">onDismiss</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">dismissButtonTapped</span><span class="p">)</span> <span class="p">}</span>
<span class="p">)</span>
<span class="o">.</span><span class="nf">confirmationDialog</span><span class="p">(</span>
    <span class="nv">route</span><span class="p">:</span> <span class="n">viewStore</span><span class="o">.</span><span class="n">route</span><span class="p">,</span>
    <span class="nv">case</span><span class="p">:</span> <span class="o">/</span><span class="kt">AppState</span><span class="o">.</span><span class="kt">Route</span><span class="o">.</span><span class="n">changeStyleConfirmationDialog</span><span class="p">,</span>
    <span class="nv">titleVisibility</span><span class="p">:</span> <span class="o">.</span><span class="n">visible</span><span class="p">,</span>
    <span class="nv">send</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">},</span>
    <span class="nv">onDismiss</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">dismissButtonTapped</span><span class="p">)</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Próxima parte, hablaremos de los sheets y de los popover. Van a tener una forma parecida a los alerts:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">.</span><span class="nf">sheet</span><span class="p">(</span>
    <span class="nv">route</span><span class="p">:</span> <span class="n">viewStore</span><span class="o">.</span><span class="n">route</span><span class="p">,</span>
    <span class="nv">case</span><span class="p">:</span> <span class="o">/</span><span class="kt">AppState</span><span class="o">.</span><span class="kt">Route</span><span class="o">.</span><span class="n">addItemSheet</span><span class="p">,</span>
    <span class="nv">onDismiss</span><span class="p">:</span> <span class="p">{</span> <span class="n">viewStore</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="o">.</span><span class="n">dismissButtonTapped</span><span class="p">)</span> <span class="p">},</span>
    <span class="nv">content</span><span class="p">:</span> <span class="p">{</span> <span class="err">$</span><span class="n">addItemState</span> <span class="k">in</span>
        <span class="kt">AddItemView</span><span class="p">(</span>
            <span class="nv">store</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="nf">scope</span><span class="p">(</span>
                <span class="nv">state</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> <span class="n">addItemState</span> <span class="p">},</span>
                <span class="nv">action</span><span class="p">:</span> <span class="kt">AppAction</span><span class="o">.</span><span class="n">addItem</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Pero esta vez, como cualquier navegación en TCA, tendremos que ver la forma de derivar dominios, esto es, haciendo scope y pullback sobre el route.</p>

<p>El código de este artículo se encuentra <a href="https://github.com/agescura/composable-architecture-route/tree/main/Examples/TCAlertsInvestigation">aquí</a>.</p>


      </section>
      <footer><p><small>Powered by <a href="https://jekyllrb.com/">Jekyll</a> &mdash; Theme by <a href="https://www.bodunhu.com/">BDHU</a></small></p></footer>
    </div>
    <script src="/assets/js/scale.fix.js"></script>
  </body>
</html>
